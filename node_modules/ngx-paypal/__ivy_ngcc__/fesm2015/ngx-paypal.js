import { ChangeDetectionStrategy, Component, Input, ViewChild, NgModule } from '@angular/core';
import { interval, Subject } from 'rxjs';
import { map, takeUntil } from 'rxjs/operators';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
/** @enum {number} */
import * as ɵngcc0 from '@angular/core';

const _c0 = ["payPalButtonContainerElem"];
const _c1 = ["payPalScriptElem"];
const PayPalFunding = {
    Card: 0,
    Credit: 1,
    Elv: 2,
};
PayPalFunding[PayPalFunding.Card] = 'Card';
PayPalFunding[PayPalFunding.Credit] = 'Credit';
PayPalFunding[PayPalFunding.Elv] = 'Elv';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
/** @enum {number} */
const PayPalIntegrationType = {
    ClientSideREST: 0,
    ServerSideREST: 1,
};
PayPalIntegrationType[PayPalIntegrationType.ClientSideREST] = 'ClientSideREST';
PayPalIntegrationType[PayPalIntegrationType.ServerSideREST] = 'ServerSideREST';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
class PayPalConfig {
    /**
     * @param {?} integrationType
     * @param {?} environment
     * @param {?} config
     */
    constructor(integrationType, environment, config) {
        this.integrationType = integrationType;
        this.environment = environment;
        /**
         * Show 'Pay Now' button config
         */
        this.commit = true;
        Object.assign(this, config);
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
class NgxPaypalComponent {
    constructor() {
        /**
         * Indicates if global configuration (provided via 'forRoot') is used
         */
        this.useGlobalConfig = false;
        /**
         * Used for indicating delayed rendered if container is not yet ready in DOM
         */
        this.registerPayPalScriptWhenContainerIsReady = false;
        /**
         * Polling interval if paypal script is pending
         */
        this.defaultPollInterval = 50;
        /**
         * Polling will stop after polling reaches this number
         */
        this.maximumPollWaitTime = 5000;
        /**
         * Name of the global variable where paypal is stored
         */
        this.paypalWindowName = 'paypal';
        /**
         * Name of the global variable indicating that script was initiated (added to page)
         */
        this.paypalWindowScriptInitiated = 'ngx-paypal-script-initiated';
        /**
         * PayPal integration script url
         */
        this.paypalScriptUrl = 'https://www.paypalobjects.com/api/checkout.js';
        this.payPalButtonContainerIdPrefix = 'ngx-paypal-button-container-';
        this.ngUnsubscribe = new Subject();
    }
    /**
     * @param {?} content
     * @return {?}
     */
    set payPalButtonContainerElem(content) {
        if (content) {
            this._payPalButtonContainerElem = content;
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        // init when config once its available
        if (this.config) {
            this.initPayPal();
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        // register script if element is ready in dom
        if (this.registerPayPalScriptWhenContainerIsReady && this._payPalButtonContainerElem) {
            this.setupScript();
            this.registerPayPalScriptWhenContainerIsReady = false;
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.ngUnsubscribe.next();
        this.ngUnsubscribe.complete();
    }
    /**
     * @return {?}
     */
    initPayPal() {
        // set unique paypal container button id
        this.payPalButtonContainerId = `${this.payPalButtonContainerIdPrefix}${this.getPseudoUniqueNumber()}`;
        // check if paypal was already register and if so, don't add it to page again
        if (!window[this.paypalWindowName]) {
            // check if script is pending
            if (window[this.paypalWindowScriptInitiated] === true) {
                this.pollUntilScriptAvailable();
            }
            else {
                // register script and set global flag
                window[this.paypalWindowScriptInitiated] = true;
                this.addPayPalScriptToPage();
            }
        }
        else {
            // just register payment
            this.handleScriptRegistering();
        }
    }
    /**
     * @return {?}
     */
    getPseudoUniqueNumber() {
        return new Date().valueOf();
    }
    /**
     * Used when there are multiple paypal components on the same page beacuse only 1 of them
     * may register paypal script. The other has to be polling until paypal is available or component destroyed
     * @return {?}
     */
    pollUntilScriptAvailable() {
        /** @type {?} */
        const obs = interval(this.defaultPollInterval)
            .pipe(takeUntil(this.ngUnsubscribe), map((x) => {
            if (x >= this.maximumPollWaitTime) {
                console.warn(`PayPal script was not loaded after '${this.maximumPollWaitTime}' maximum polling time.`);
                obs.unsubscribe();
                return;
            }
            // check if paypal script exists
            if (window[this.paypalWindowName]) {
                // register script
                this.handleScriptRegistering();
                // stop execution
                obs.unsubscribe();
            }
        }))
            .subscribe();
    }
    /**
     * @return {?}
     */
    addPayPalScriptToPage() {
        /** @type {?} */
        const script = document.createElement('script');
        script.innerHTML = '';
        script.src = this.paypalScriptUrl;
        script.onload = () => this.handleScriptRegistering();
        script.async = true;
        script.defer = true;
        this.paypalScriptElem.nativeElement.appendChild(script);
    }
    /**
     * @return {?}
     */
    handleScriptRegistering() {
        // check if container with requested id exists
        // this is here because dynamically switching between components would cause PayPal to
        // throw an error if the container already existed before
        if (this._payPalButtonContainerElem && this._payPalButtonContainerElem.nativeElement &&
            this._payPalButtonContainerElem.nativeElement.id === this.payPalButtonContainerId) {
            // container is ready, setup script right away
            this.setupScript();
        }
        else {
            // container is not ready, delay registering until it is
            this.registerPayPalScriptWhenContainerIsReady = true;
        }
    }
    /**
     * @return {?}
     */
    setupScript() {
        // first clear container
        if (!this._payPalButtonContainerElem) {
            throw Error(`Cannot setup script because paypal button container with id '${this.payPalButtonContainerId}' is not yet ready`);
        }
        this._payPalButtonContainerElem.nativeElement.innerHTML = '';
        if (!window[this.paypalWindowName]) {
            throw Error('PayPal script is not available');
        }
        // render PayPal button as per their docs at
        // https://developer.paypal.com/docs/integration/direct/express-checkout/integration-jsv4/add-paypal-button/
        window[this.paypalWindowName].Button.render({
            // set environment
            env: this.config.environment.toString(),
            // Show the buyer a 'Pay Now' button in the checkout flow
            commit: this.config.commit,
            // init client for client side integration
            client: this.getClient(),
            // set button config if available
            style: this.config.button,
            // set funding if available
            funding: this.getFunding(),
            // payment() is called when the button is clicked
            payment: (data, actions) => {
                if (this.config.integrationType === PayPalIntegrationType.ServerSideREST) {
                    // client needs to create payment on server side
                    if (!this.config.payment) {
                        throw Error(`You need set up a create payment method and return
                            PayPal's payment id when using server side integration`);
                    }
                    // Paypal expects promise with payment id (string) to be returned
                    return this.config.payment().toPromise()
                        .then(paymentId => {
                        return paymentId;
                    });
                }
                if (this.config.integrationType === PayPalIntegrationType.ClientSideREST) {
                    if (!this.config.transactions || !Array.isArray(this.config.transactions) || this.config.transactions.length <= 0) {
                        throw Error(`You need to provide at least 1 transaction for client side integration`);
                    }
                    /** @type {?} */
                    const experienceConfig = this.config.experience;
                    return actions.payment.create({
                        payment: {
                            transactions: this.config.transactions
                        },
                        experience: {
                            input_fields: {
                                no_shipping: (experienceConfig && experienceConfig.noShipping) ? 1 : 0
                            },
                            presentation: {
                                brand_name: (experienceConfig && experienceConfig.brandName) ? experienceConfig.brandName : null,
                                logo_image: (experienceConfig && experienceConfig.logoImage) ? experienceConfig.logoImage : null,
                                locale_code: (experienceConfig && experienceConfig.localeCode) ? experienceConfig.localeCode : null
                            }
                        }
                    });
                }
            },
            // onAuthorize() is called when the buyer approves the payment
            onAuthorize: (data, actions) => {
                if (this.config.integrationType === PayPalIntegrationType.ServerSideREST) {
                    // client needs to server to execute the payment
                    if (!this.config.onAuthorize) {
                        throw Error(`You need set up an execute method when using server side integration`);
                    }
                    // Paypal expects promise
                    return this.config.onAuthorize(data, actions).toPromise();
                }
                if (this.config.integrationType === PayPalIntegrationType.ClientSideREST) {
                    // Make a call to the REST api to execute the payment
                    return actions.payment.execute().then(() => {
                        if (!this.config.onPaymentComplete) {
                            throw Error(`You should provide some callback when payment is finished when using client side integration`);
                        }
                        this.config.onPaymentComplete(data, actions);
                    });
                }
            },
            onError: (err) => {
                if (this.config.onError) {
                    this.config.onError(err);
                }
            },
            onCancel: (data, actions) => {
                if (this.config.onCancel) {
                    this.config.onCancel(data, actions);
                }
            },
            onClick: () => {
                if (this.config.onClick) {
                    this.config.onClick();
                }
            },
            validate: (actions) => {
                if (this.config.validate) {
                    this.config.validate(actions);
                }
            }
        }, `#${this.payPalButtonContainerId}`);
    }
    /**
     * @return {?}
     */
    getClient() {
        if (this.config.integrationType === PayPalIntegrationType.ClientSideREST) {
            if (!this.config.client) {
                throw Error(`You need to setup client information when using client side integration`);
            }
            return {
                production: this.config.client.production,
                sandbox: this.config.client.sandbox
            };
        }
        return undefined;
    }
    /**
     * @return {?}
     */
    getFunding() {
        // resolve funding to use paypal's properties
        if (!this.config.funding) {
            // no funding provided
            return undefined;
        }
        /** @type {?} */
        const allowed = [];
        /** @type {?} */
        const disallowed = [];
        if (this.config.funding.allowed) {
            this.config.funding.allowed.forEach(type => {
                allowed.push(this.mapFundingType(type));
            });
        }
        if (this.config.funding.disallowed) {
            this.config.funding.disallowed.forEach(type => {
                disallowed.push(this.mapFundingType(type));
            });
        }
        return {
            allowed: allowed,
            disallowed: disallowed
        };
    }
    /**
     * @param {?} type
     * @return {?}
     */
    mapFundingType(type) {
        if (type === PayPalFunding.Card) {
            return paypal.FUNDING.CARD;
        }
        if (type === PayPalFunding.Credit) {
            return paypal.FUNDING.CREDIT;
        }
        if (type === PayPalFunding.Elv) {
            return paypal.FUNDING.ELV;
        }
        throw Error(`Unsupported funding type '${type}'`);
    }
}
NgxPaypalComponent.ɵfac = function NgxPaypalComponent_Factory(t) { return new (t || NgxPaypalComponent)(); };
NgxPaypalComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: NgxPaypalComponent, selectors: [["ngx-paypal"]], viewQuery: function NgxPaypalComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, true);
        ɵngcc0.ɵɵviewQuery(_c1, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.payPalButtonContainerElem = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.paypalScriptElem = _t.first);
    } }, inputs: { useGlobalConfig: "useGlobalConfig", config: "config" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 4, vars: 1, consts: [["payPalScriptElem", ""], [3, "id"], ["payPalButtonContainerElem", ""]], template: function NgxPaypalComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelement(0, "div", null, 0);
        ɵngcc0.ɵɵelement(2, "div", 1, 2);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("id", ctx.payPalButtonContainerId);
    } }, encapsulation: 2, changeDetection: 0 });
/** @nocollapse */
NgxPaypalComponent.ctorParameters = () => [];
NgxPaypalComponent.propDecorators = {
    config: [{ type: Input }],
    useGlobalConfig: [{ type: Input }],
    paypalScriptElem: [{ type: ViewChild, args: ['payPalScriptElem',] }],
    payPalButtonContainerElem: [{ type: ViewChild, args: ['payPalButtonContainerElem',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgxPaypalComponent, [{
        type: Component,
        args: [{
                changeDetection: ChangeDetectionStrategy.OnPush,
                selector: 'ngx-paypal',
                template: `
    <div #payPalScriptElem></div>
    <div #payPalButtonContainerElem [id]="payPalButtonContainerId"></div>
    `
            }]
    }], function () { return []; }, { useGlobalConfig: [{
            type: Input
        }], payPalButtonContainerElem: [{
            type: ViewChild,
            args: ['payPalButtonContainerElem']
        }], config: [{
            type: Input
        }], paypalScriptElem: [{
            type: ViewChild,
            args: ['payPalScriptElem']
        }] }); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
class NgxPayPalModule {
}
NgxPayPalModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: NgxPayPalModule });
NgxPayPalModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function NgxPayPalModule_Factory(t) { return new (t || NgxPayPalModule)(); }, imports: [[]] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(NgxPayPalModule, { declarations: [NgxPaypalComponent], exports: [NgxPaypalComponent] }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgxPayPalModule, [{
        type: NgModule,
        args: [{
                imports: [],
                declarations: [
                    NgxPaypalComponent,
                ],
                exports: [
                    NgxPaypalComponent,
                ]
            }]
    }], null, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
/** @enum {string} */
const PayPalEnvironment = {
    Sandbox: 'sandbox',
    Production: 'production',
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */

export { NgxPayPalModule, PayPalEnvironment, PayPalFunding, PayPalIntegrationType, PayPalConfig, NgxPaypalComponent, NgxPaypalComponent as ɵa };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXBheXBhbC5qcyIsInNvdXJjZXMiOlsibmc6L25neC1wYXlwYWwvbGliL21vZGVscy9wYXlwYWwtZnVuZGluZy50cyIsIm5nOi9uZ3gtcGF5cGFsL2xpYi9tb2RlbHMvcGF5cGFsLWludGVncmF0aW9uLnRzIiwibmc6L25neC1wYXlwYWwvbGliL21vZGVscy9wYXlwYWwtbW9kZWxzLnRzIiwibmc6L25neC1wYXlwYWwvbGliL2NvbXBvbmVudHMvcGF5cGFsLWNvbXBvbmVudC50cyIsIm5nOi9uZ3gtcGF5cGFsL2xpYi9uZ3gtcGF5cGFsLm1vZHVsZS50cyIsIm5nOi9uZ3gtcGF5cGFsL2xpYi9tb2RlbHMvcGF5cGFsLWVudmlyb25tZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0lBQ0ksT0FBSTtJQUNKLFNBQU07SUFDTixNQUFHOzs0QkFGSCxJQUFJOzRCQUNKLE1BQU07NEJBQ04sR0FBRzs7Ozs7Ozs7SUNGSCxpQkFBYztJQUNkLGlCQUFjOzs0Q0FEZCxjQUFjOzRDQUNkLGNBQWM7Ozs7OztBQ0lsQjs7Ozs7O0lBbUVJLFlBSVcsaUJBSUEsYUFDUCxNQWVDO1FBcEJNLG9CQUFlLEdBQWYsZUFBZTtRQUlmLGdCQUFXLEdBQVgsV0FBVzs7OztzQkF0RU4sSUFBSTtRQXVGaEIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7S0FDL0I7Q0FDSjs7Ozs7O0FDcEdEO0lBaUdJOzs7OytCQXhEMkIsS0FBSzs7Ozt3REFVbUIsS0FBSzs7OzttQ0FlakIsRUFBRTs7OzttQ0FLRixJQUFJOzs7O2dDQUtQLFFBQVE7Ozs7MkNBS0csNkJBQTZCOzs7OytCQUt6QywrQ0FBK0M7NkNBT2pDLDhCQUE4Qjs2QkFFL0IsSUFBSSxPQUFPLEVBQVE7S0FJbEU7Ozs7O0lBMUNELElBQTRDLHlCQUF5QixDQUFDLE9BQW1CO1FBQ3JGLElBQUksT0FBTyxFQUFFO1lBQ1QsSUFBSSxDQUFDLDBCQUEwQixHQUFHLE9B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QUUsc0JBQ1o7U0FBa0IsbUJBQ25CLGtCQUNELE9BQU8sRUFBRSxzQkFDUCxrQkFBa0IsbUJBQ25CLGNBQ0Y7Ozs7Ozs7Ozs7OzswQkFDSTs7Ozs7Ozs7SUNiRCxTQUFVLFNBQVM7SUFDbkIsWUFBYSxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGVudW0gUGF5UGFsRnVuZGluZyB7XHJcbiAgICBDYXJkLFxyXG4gICAgQ3JlZGl0LFxyXG4gICAgRWx2XHJcbn1cclxuIiwiZXhwb3J0IGVudW0gUGF5UGFsSW50ZWdyYXRpb25UeXBlIHtcclxuICAgIENsaWVudFNpZGVSRVNULFxyXG4gICAgU2VydmVyU2lkZVJFU1QsXHJcbn1cclxuIiwiaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgUGF5UGFsRnVuZGluZyB9IGZyb20gJy4vcGF5cGFsLWZ1bmRpbmcnO1xyXG5pbXBvcnQgeyBQYXlQYWxFbnZpcm9ubWVudCB9IGZyb20gJy4vcGF5cGFsLWVudmlyb25tZW50JztcclxuaW1wb3J0IHsgUGF5UGFsSW50ZWdyYXRpb25UeXBlIH0gZnJvbSAnLi9wYXlwYWwtaW50ZWdyYXRpb24nO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBheVBhbENvbmZpZyB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTaG93ICdQYXkgTm93JyBidXR0b24gY29uZmlnXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjb21taXQgPSB0cnVlO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2FsbGVkIHRvIGNyZWF0ZSBuZXcgcGF5bWVudCBmb3Igc2VydmVyIHNpZGUgaW50ZWdyYXRpb25cclxuICAgICAqL1xyXG4gICAgcHVibGljIHBheW1lbnQ/OiAoKSA9PiBPYnNlcnZhYmxlPHN0cmluZz47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgdG8gZXhlY3V0ZSBwYXltZW50IGZvciBzZXJ2ZXIgc2lkZSBpbnRlZ3JhdGlvblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25BdXRob3JpemU/OiAoZGF0YTogSVBheVBhbFBheW1lbnRDb21wbGV0ZURhdGEsIGFjdGlvbnM6IGFueSkgPT4gT2JzZXJ2YWJsZTx2b2lkPjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIENsaWVudCB0b2tlbnMgZm9yIGNsaWVudCBzaWRlIGludGVncmF0aW9uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjbGllbnQ/OiBJUGF5cGFsQ2xpZW50O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQXJyYXkgb2YgdHJhbnNhY3Rpb24sIHJlcXVpcmVkIGZvciBjbGllbnQgc2lkZSBpbnRlZ3JhdGlvblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdHJhbnNhY3Rpb25zPzogSVBheVBhbFRyYW5zYWN0aW9uW107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQYXltZW50IEV4cGVyaWVuY2UgY29uZmlndXJhdGlvbnNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGV4cGVyaWVuY2U/OiBJUGF5UGFsRXhwZXJpZW5jZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIENhbGxlZCBmb3IgY2xpZW50IHNpZGUgaW50ZWdyYXRpb24gd2hlbiBwYXltZW50IGlzIGV4ZWN1dGVkXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvblBheW1lbnRDb21wbGV0ZT86IChkYXRhOiBJUGF5UGFsUGF5bWVudENvbXBsZXRlRGF0YSwgYWN0aW9uczogYW55KSA9PiB2b2lkO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQnV0dG9uIGNvbmZpZ3VyYXRpb25cclxuICAgICAqL1xyXG4gICAgcHVibGljIGJ1dHRvbj86IElQYXlQYWxCdXR0b25TdHlsZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFBheXBhbCBmdW5kaW5nIGNvbmZpZ3VyYXRpb25cclxuICAgICAqL1xyXG4gICAgcHVibGljIGZ1bmRpbmc/OiBJUGF5UGFsRnVuZGluZztcclxuXHJcbiAgICAvKipcclxuICAgICAqIENhbGxlZCB3aGVuIFBheVBhbCBleHBlcmllbmNlcyBhbiBlcnJvclxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb25FcnJvcj86IChlcnI6IGFueSkgPT4gdm9pZDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgaGFuZGxlciB3aWxsIGJlIGNhbGxlZCBmb3IgZXZlcnkgY2xpY2sgb24gdGhlIFBheVBhbCBidXR0b25cclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2xpY2s/OiAoKSA9PiB2b2lkO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2FsbGVkIHdoZW4gdXNlciBjYW5jZWxzIHBheW1lbnRcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uQ2FuY2VsPzogKGRhdGE6IElQYXlQYWxDYW5jZWxQYXltZW50LCBhY3Rpb25zOiBhbnkpID0+IHZvaWQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDYW4gYmUgdXNlZCB0byB2YWxpZGF0aW9uIGFzIGNhbiBiZSBzZWVuIGhlcmU6IGh0dHBzOi8vZGV2ZWxvcGVyLnBheXBhbC5jb20vZGVtby9jaGVja291dC8jL3BhdHRlcm4vdmFsaWRhdGlvblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdmFsaWRhdGU/OiAoYWN0aW9uczogYW55KSA9PiB2b2lkO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFR5cGUgb2YgdGhlIGludGVncmF0aW9uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgcHVibGljIGludGVncmF0aW9uVHlwZTogUGF5UGFsSW50ZWdyYXRpb25UeXBlLFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEVudmlyb25tZW50XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgcHVibGljIGVudmlyb25tZW50OiBQYXlQYWxFbnZpcm9ubWVudCxcclxuICAgICAgICBjb25maWc6IHtcclxuICAgICAgICAgICAgb25FcnJvcj86IChlcnI6IGFueSkgPT4gdm9pZCxcclxuICAgICAgICAgICAgb25DbGljaz86ICgpID0+IHZvaWQsXHJcbiAgICAgICAgICAgIHZhbGlkYXRlPzogKGFjdGlvbnM6IGFueSkgPT4gdm9pZDtcclxuICAgICAgICAgICAgb25DYW5jZWw/OiAoZGF0YTogSVBheVBhbENhbmNlbFBheW1lbnQsIGFjdGlvbnM6IGFueSkgPT4gdm9pZCxcclxuICAgICAgICAgICAgcGF5bWVudD86ICgpID0+IE9ic2VydmFibGU8c3RyaW5nPixcclxuICAgICAgICAgICAgb25BdXRob3JpemU/OiAoZGF0YTogSVBheVBhbFBheW1lbnRDb21wbGV0ZURhdGEsIGFjdGlvbnM6IGFueSkgPT4gT2JzZXJ2YWJsZTx2b2lkPixcclxuICAgICAgICAgICAgY2xpZW50PzogSVBheXBhbENsaWVudCxcclxuICAgICAgICAgICAgb25QYXltZW50Q29tcGxldGU/OiAoZGF0YTogSVBheVBhbFBheW1lbnRDb21wbGV0ZURhdGEsIGFjdGlvbnM6IGFueSkgPT4gdm9pZCxcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25zPzogSVBheVBhbFRyYW5zYWN0aW9uW10sXHJcbiAgICAgICAgICAgIG5vdGVfdG9fcGF5ZXI/OiBzdHJpbmc7XHJcbiAgICAgICAgICAgIGV4cGVyaWVuY2U/OiBJUGF5UGFsRXhwZXJpZW5jZSxcclxuICAgICAgICAgICAgY29tbWl0PzogYm9vbGVhbixcclxuICAgICAgICAgICAgYnV0dG9uPzogSVBheVBhbEJ1dHRvblN0eWxlLFxyXG4gICAgICAgICAgICBmdW5kaW5nPzogSVBheVBhbEZ1bmRpbmdcclxuICAgICAgICB9KSB7XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBjb25maWcpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElQYXlQYWxQYXltZW50Q29tcGxldGVEYXRhIHtcclxuICAgIGludGVudDogc3RyaW5nO1xyXG4gICAgb3JkZXJJRDogc3RyaW5nO1xyXG4gICAgcGF5ZXJJRDogc3RyaW5nO1xyXG4gICAgcGF5bWVudElEOiBzdHJpbmc7XHJcbiAgICBwYXltZW50VG9rZW46IHN0cmluZztcclxuICAgIHJldHVyblVybDogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElQYXlQYWxDYW5jZWxQYXltZW50IHtcclxuICAgIGRhdGE6IElQYXlQYWxDYW5jZWxQYXltZW50RGF0YTtcclxuICAgIGFjdGlvbnM6IGFueTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJUGF5UGFsQ2FuY2VsUGF5bWVudERhdGEge1xyXG4gICAgYmlsbGluZ0lEOiBzdHJpbmc7XHJcbiAgICBjYW5jZWxVcmw6IHN0cmluZztcclxuICAgIGludGVudDogc3RyaW5nO1xyXG4gICAgcGF5bWVudElEOiBzdHJpbmc7XHJcbiAgICBwYXltZW50VG9rZW46IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJUGF5cGFsQ2xpZW50IHtcclxuICAgIHNhbmRib3g/OiBzdHJpbmc7XHJcbiAgICBwcm9kdWN0aW9uPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElQYXlQYWxUcmFuc2FjdGlvbiB7XHJcbiAgICBhbW91bnQ6IElQYXlQYWxBbW91bnQ7XHJcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcclxuICAgIGN1c3RvbT86IHN0cmluZztcclxuICAgIHBheW1lbnRfb3B0aW9ucz86IElQYXlQYWxUcmFuc2FjdGlvblBheW1lbnRPcHRpb25zO1xyXG4gICAgc29mdF9kZXNjcmlwdG9yPzogc3RyaW5nO1xyXG4gICAgaXRlbV9saXN0PzogSVBheVBhbFRyYW5zYWN0aW9uSXRlbUxpc3Q7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVBheVBhbFRyYW5zYWN0aW9uSXRlbUxpc3Qge1xyXG4gICAgaXRlbXM/OiBJUGF5UGFsVHJhbnNhY3Rpb25JdGVtW107XHJcbiAgICBzaGlwcGluZ19hZGRyZXNzPzogSVBheVBhbFRyYW5zYWN0aW9uU2hpcHBpbmdBZGRyZXNzO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElQYXlQYWxUcmFuc2FjdGlvbkl0ZW0ge1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgY3VycmVuY3k6IHN0cmluZztcclxuICAgIHByaWNlOiBudW1iZXI7XHJcbiAgICBxdWFudGl0eTogbnVtYmVyO1xyXG5cclxuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xyXG4gICAgdGF4PzogbnVtYmVyO1xyXG4gICAgc2t1Pzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElQYXlQYWxBbW91bnQge1xyXG4gICAgdG90YWw6IG51bWJlcjtcclxuICAgIGN1cnJlbmN5OiBzdHJpbmc7XHJcbiAgICBkZXRhaWxzPzogSVBheVBhbEFtb3VudERldGFpbHM7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVBheVBhbFRyYW5zYWN0aW9uU2hpcHBpbmdBZGRyZXNzIHtcclxuICAgIHJlY2lwaWVudF9uYW1lOiBzdHJpbmc7XHJcbiAgICBsaW5lMTogc3RyaW5nO1xyXG4gICAgbGluZTI/OiBzdHJpbmc7XHJcbiAgICBjaXR5OiBzdHJpbmc7XHJcbiAgICBjb3VudHJ5X2NvZGU6IHN0cmluZztcclxuICAgIHBvc3RhbF9jb2RlOiBzdHJpbmc7XHJcbiAgICBwaG9uZTogc3RyaW5nO1xyXG4gICAgc3RhdGU6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJUGF5UGFsQW1vdW50RGV0YWlscyB7XHJcbiAgICBzdWJ0b3RhbDogbnVtYmVyO1xyXG4gICAgdGF4OiBudW1iZXI7XHJcbiAgICBzaGlwcGluZzogbnVtYmVyO1xyXG4gICAgaGFuZGxpbmdfZmVlOiBudW1iZXI7XHJcbiAgICBzaGlwcGluZ19kaXNjb3VudDogbnVtYmVyO1xyXG4gICAgaW5zdXJhbmNlOiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVBheVBhbFRyYW5zYWN0aW9uUGF5bWVudE9wdGlvbnMge1xyXG4gICAgYWxsb3dlZF9wYXltZW50X21ldGhvZD86IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJUGF5UGFsRXhwZXJpZW5jZSB7XHJcbiAgICAvKiogSW5kaWNhdGVzIHdoZXRoZXIgUGF5UGFsIGRpc3BsYXlzIHNoaXBwaW5nIGFkZHJlc3MgZmllbGRzIG9uIHRoZSBleHBlcmllbmNlIHBhZ2VzICovXHJcbiAgICBub1NoaXBwaW5nPzogYm9vbGVhbjtcclxuICAgIC8qKiBBIGxhYmVsIHRoYXQgb3ZlcnJpZGVzIHRoZSBidXNpbmVzcyBuYW1lIGluIHRoZSBQYXlQYWwgYWNjb3VudCBvbiB0aGUgUGF5UGFsIHBhZ2VzLiBNYXggbGVuZ3RoOiAxMjcgY2hhcmFjdGVycy4gKi9cclxuICAgIGJyYW5kTmFtZT86IHN0cmluZztcclxuICAgIC8qKiBVUkwgdG8gdGhlIGxvZ28gaW1hZ2UgKGdpZiwganBnLCBvciBwbmcpLiBUaGUgaW1hZ2UncyBtYXhpbXVtIHdpZHRoIGlzIDE5MCBwaXhlbHMgYW5kIG1heGltdW0gaGVpZ2h0IGlzIDYwIHBpeGVscy4gKi9cclxuICAgIGxvZ29JbWFnZT86IHN0cmluZztcclxuICAgIC8qKiBMb2NhbGUgaW4gd2hpY2ggdG8gZGlzcGxheSBQYXlQYWwgcGFnZSAqL1xyXG4gICAgbG9jYWxlQ29kZT86IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJUGF5UGFsQnV0dG9uU3R5bGUge1xyXG4gICAgbGFiZWw/OiAnY2hlY2tvdXQnIHwgJ3BheScgfCAnYnV5bm93JyB8ICdwYXlwYWwnO1xyXG4gICAgc2l6ZT86ICdzbWFsbCcgfCAnbWVkaXVtJyB8ICdsYXJnZScgfCAncmVzcG9uc2l2ZSc7XHJcbiAgICBzaGFwZT86ICdwaWxsJyB8ICdyZWN0JztcclxuICAgIGNvbG9yPzogJ2dvbGQnIHwgJ2JsdWUnIHwgJ3NpbHZlcicgfCAnYmxhY2snO1xyXG4gICAgbGF5b3V0PzogJ2hvcml6b250YWwnIHwgJ3ZlcnRpY2FsJztcclxuICAgIHRhZ2xpbmU/OiBmYWxzZTtcclxuICAgIGZ1bmRpbmdpY29ucz86IGJvb2xlYW47XHJcbiAgICBicmFuZGluZz86IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVBheVBhbEZ1bmRpbmcge1xyXG4gICAgYWxsb3dlZDogUGF5UGFsRnVuZGluZ1tdO1xyXG4gICAgZGlzYWxsb3dlZDogUGF5UGFsRnVuZGluZ1tdO1xyXG59XHJcblxyXG4iLCJpbXBvcnQge1xyXG4gICAgQWZ0ZXJWaWV3SW5pdCxcclxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG4gICAgQ29tcG9uZW50LFxyXG4gICAgRWxlbWVudFJlZixcclxuICAgIElucHV0LFxyXG4gICAgT25DaGFuZ2VzLFxyXG4gICAgT25EZXN0cm95LFxyXG4gICAgU2ltcGxlQ2hhbmdlcyxcclxuICAgIFZpZXdDaGlsZCxcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgaW50ZXJ2YWwsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwLCB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgeyBQYXlQYWxGdW5kaW5nIH0gZnJvbSAnLi4vbW9kZWxzL3BheXBhbC1mdW5kaW5nJztcclxuaW1wb3J0IHsgUGF5UGFsSW50ZWdyYXRpb25UeXBlIH0gZnJvbSAnLi4vbW9kZWxzL3BheXBhbC1pbnRlZ3JhdGlvbic7XHJcbmltcG9ydCB7IElQYXlwYWxDbGllbnQsIElQYXlQYWxQYXltZW50Q29tcGxldGVEYXRhLCBQYXlQYWxDb25maWcgfSBmcm9tICcuLi9tb2RlbHMvcGF5cGFsLW1vZGVscyc7XHJcblxyXG4vKipcclxuICogR2xvYmFsIHZhcmlhYmxlIHdoZXJlIFBheVBhbCBpcyBsb2FkZWQgdG9cclxuICovXHJcbmRlY2xhcmUgdmFyIHBheXBhbDogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcclxuICAgIHNlbGVjdG9yOiAnbmd4LXBheXBhbCcsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgPGRpdiAjcGF5UGFsU2NyaXB0RWxlbT48L2Rpdj5cclxuICAgIDxkaXYgI3BheVBhbEJ1dHRvbkNvbnRhaW5lckVsZW0gW2lkXT1cInBheVBhbEJ1dHRvbkNvbnRhaW5lcklkXCI+PC9kaXY+XHJcbiAgICBgXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOZ3hQYXlwYWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDb25maWd1cmF0aW9uIGZvciBwYXlwYWwuXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGNvbmZpZzogUGF5UGFsQ29uZmlnO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5kaWNhdGVzIGlmIGdsb2JhbCBjb25maWd1cmF0aW9uIChwcm92aWRlZCB2aWEgJ2ZvclJvb3QnKSBpcyB1c2VkXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIHVzZUdsb2JhbENvbmZpZyA9IGZhbHNlO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ29udGFpbmVyIGZvciBwYXlwYWwgc2NyaXB0XHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoJ3BheVBhbFNjcmlwdEVsZW0nKSBwYXlwYWxTY3JpcHRFbGVtOiBFbGVtZW50UmVmO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCBmb3IgaW5kaWNhdGluZyBkZWxheWVkIHJlbmRlcmVkIGlmIGNvbnRhaW5lciBpcyBub3QgeWV0IHJlYWR5IGluIERPTVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyUGF5UGFsU2NyaXB0V2hlbkNvbnRhaW5lcklzUmVhZHkgPSBmYWxzZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEhvbGRzIGN1cnJlbnQgY29udGFpbmVyIGVsZW1lbnRcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfcGF5UGFsQnV0dG9uQ29udGFpbmVyRWxlbT86IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdwYXlQYWxCdXR0b25Db250YWluZXJFbGVtJykgc2V0IHBheVBhbEJ1dHRvbkNvbnRhaW5lckVsZW0oY29udGVudDogRWxlbWVudFJlZikge1xyXG4gICAgICAgIGlmIChjb250ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3BheVBhbEJ1dHRvbkNvbnRhaW5lckVsZW0gPSBjb250ZW50O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFBvbGxpbmcgaW50ZXJ2YWwgaWYgcGF5cGFsIHNjcmlwdCBpcyBwZW5kaW5nXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGVmYXVsdFBvbGxJbnRlcnZhbCA9IDUwO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUG9sbGluZyB3aWxsIHN0b3AgYWZ0ZXIgcG9sbGluZyByZWFjaGVzIHRoaXMgbnVtYmVyXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgbWF4aW11bVBvbGxXYWl0VGltZSA9IDUwMDA7XHJcblxyXG4gICAgLyoqXHJcbiAgICAqIE5hbWUgb2YgdGhlIGdsb2JhbCB2YXJpYWJsZSB3aGVyZSBwYXlwYWwgaXMgc3RvcmVkXHJcbiAgICAqL1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBwYXlwYWxXaW5kb3dOYW1lID0gJ3BheXBhbCc7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBOYW1lIG9mIHRoZSBnbG9iYWwgdmFyaWFibGUgaW5kaWNhdGluZyB0aGF0IHNjcmlwdCB3YXMgaW5pdGlhdGVkIChhZGRlZCB0byBwYWdlKVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHBheXBhbFdpbmRvd1NjcmlwdEluaXRpYXRlZCA9ICduZ3gtcGF5cGFsLXNjcmlwdC1pbml0aWF0ZWQnO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGF5UGFsIGludGVncmF0aW9uIHNjcmlwdCB1cmxcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBwYXlwYWxTY3JpcHRVcmwgPSAnaHR0cHM6Ly93d3cucGF5cGFsb2JqZWN0cy5jb20vYXBpL2NoZWNrb3V0LmpzJztcclxuXHJcbiAgICAvKipcclxuICAgICAqIElkIG9mIHRoZSBlbGVtZW50IHdoZXJlIFBheVBhbCBidXR0b24gd2lsbCBiZSByZW5kZXJlZFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcGF5UGFsQnV0dG9uQ29udGFpbmVySWQ/OiBzdHJpbmc7XHJcblxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBwYXlQYWxCdXR0b25Db250YWluZXJJZFByZWZpeCA9ICduZ3gtcGF5cGFsLWJ1dHRvbi1jb250YWluZXItJztcclxuXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IG5nVW5zdWJzY3JpYmU6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIC8vIGluaXQgd2hlbiBjb25maWcgb25jZSBpdHMgYXZhaWxhYmxlXHJcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdFBheVBhbCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAgICAgLy8gcmVnaXN0ZXIgc2NyaXB0IGlmIGVsZW1lbnQgaXMgcmVhZHkgaW4gZG9tXHJcbiAgICAgICAgaWYgKHRoaXMucmVnaXN0ZXJQYXlQYWxTY3JpcHRXaGVuQ29udGFpbmVySXNSZWFkeSAmJiB0aGlzLl9wYXlQYWxCdXR0b25Db250YWluZXJFbGVtKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0dXBTY3JpcHQoKTtcclxuICAgICAgICAgICAgdGhpcy5yZWdpc3RlclBheVBhbFNjcmlwdFdoZW5Db250YWluZXJJc1JlYWR5ID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubmdVbnN1YnNjcmliZS5uZXh0KCk7XHJcbiAgICAgICAgdGhpcy5uZ1Vuc3Vic2NyaWJlLmNvbXBsZXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0UGF5UGFsKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIHNldCB1bmlxdWUgcGF5cGFsIGNvbnRhaW5lciBidXR0b24gaWRcclxuICAgICAgICB0aGlzLnBheVBhbEJ1dHRvbkNvbnRhaW5lcklkID0gYCR7dGhpcy5wYXlQYWxCdXR0b25Db250YWluZXJJZFByZWZpeH0ke3RoaXMuZ2V0UHNldWRvVW5pcXVlTnVtYmVyKCl9YDtcclxuICAgICAgICAvLyBjaGVjayBpZiBwYXlwYWwgd2FzIGFscmVhZHkgcmVnaXN0ZXIgYW5kIGlmIHNvLCBkb24ndCBhZGQgaXQgdG8gcGFnZSBhZ2FpblxyXG4gICAgICAgIGlmICghd2luZG93W3RoaXMucGF5cGFsV2luZG93TmFtZV0pIHtcclxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgc2NyaXB0IGlzIHBlbmRpbmdcclxuICAgICAgICAgICAgaWYgKHdpbmRvd1t0aGlzLnBheXBhbFdpbmRvd1NjcmlwdEluaXRpYXRlZF0gPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucG9sbFVudGlsU2NyaXB0QXZhaWxhYmxlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyByZWdpc3RlciBzY3JpcHQgYW5kIHNldCBnbG9iYWwgZmxhZ1xyXG4gICAgICAgICAgICAgICAgd2luZG93W3RoaXMucGF5cGFsV2luZG93U2NyaXB0SW5pdGlhdGVkXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkZFBheVBhbFNjcmlwdFRvUGFnZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGp1c3QgcmVnaXN0ZXIgcGF5bWVudFxyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZVNjcmlwdFJlZ2lzdGVyaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UHNldWRvVW5pcXVlTnVtYmVyKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkudmFsdWVPZigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB3aGVuIHRoZXJlIGFyZSBtdWx0aXBsZSBwYXlwYWwgY29tcG9uZW50cyBvbiB0aGUgc2FtZSBwYWdlIGJlYWN1c2Ugb25seSAxIG9mIHRoZW1cclxuICAgICAqIG1heSByZWdpc3RlciBwYXlwYWwgc2NyaXB0LiBUaGUgb3RoZXIgaGFzIHRvIGJlIHBvbGxpbmcgdW50aWwgcGF5cGFsIGlzIGF2YWlsYWJsZSBvciBjb21wb25lbnQgZGVzdHJveWVkXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcG9sbFVudGlsU2NyaXB0QXZhaWxhYmxlKCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IG9icyA9IGludGVydmFsKHRoaXMuZGVmYXVsdFBvbGxJbnRlcnZhbClcclxuICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5uZ1Vuc3Vic2NyaWJlKSxcclxuICAgICAgICAgICAgICAgIG1hcCgoeCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh4ID49IHRoaXMubWF4aW11bVBvbGxXYWl0VGltZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFBheVBhbCBzY3JpcHQgd2FzIG5vdCBsb2FkZWQgYWZ0ZXIgJyR7dGhpcy5tYXhpbXVtUG9sbFdhaXRUaW1lfScgbWF4aW11bSBwb2xsaW5nIHRpbWUuYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9icy51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBwYXlwYWwgc2NyaXB0IGV4aXN0c1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3dbdGhpcy5wYXlwYWxXaW5kb3dOYW1lXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyByZWdpc3RlciBzY3JpcHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTY3JpcHRSZWdpc3RlcmluZygpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RvcCBleGVjdXRpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhZGRQYXlQYWxTY3JpcHRUb1BhZ2UoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XHJcbiAgICAgICAgc2NyaXB0LmlubmVySFRNTCA9ICcnO1xyXG4gICAgICAgIHNjcmlwdC5zcmMgPSB0aGlzLnBheXBhbFNjcmlwdFVybDtcclxuICAgICAgICBzY3JpcHQub25sb2FkID0gKCkgPT4gdGhpcy5oYW5kbGVTY3JpcHRSZWdpc3RlcmluZygpO1xyXG4gICAgICAgIHNjcmlwdC5hc3luYyA9IHRydWU7XHJcbiAgICAgICAgc2NyaXB0LmRlZmVyID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgdGhpcy5wYXlwYWxTY3JpcHRFbGVtLm5hdGl2ZUVsZW1lbnQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGhhbmRsZVNjcmlwdFJlZ2lzdGVyaW5nKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIGNoZWNrIGlmIGNvbnRhaW5lciB3aXRoIHJlcXVlc3RlZCBpZCBleGlzdHNcclxuICAgICAgICAvLyB0aGlzIGlzIGhlcmUgYmVjYXVzZSBkeW5hbWljYWxseSBzd2l0Y2hpbmcgYmV0d2VlbiBjb21wb25lbnRzIHdvdWxkIGNhdXNlIFBheVBhbCB0b1xyXG4gICAgICAgIC8vIHRocm93IGFuIGVycm9yIGlmIHRoZSBjb250YWluZXIgYWxyZWFkeSBleGlzdGVkIGJlZm9yZVxyXG4gICAgICAgIGlmICh0aGlzLl9wYXlQYWxCdXR0b25Db250YWluZXJFbGVtICYmIHRoaXMuX3BheVBhbEJ1dHRvbkNvbnRhaW5lckVsZW0ubmF0aXZlRWxlbWVudCAmJlxyXG4gICAgICAgICAgICB0aGlzLl9wYXlQYWxCdXR0b25Db250YWluZXJFbGVtLm5hdGl2ZUVsZW1lbnQuaWQgPT09IHRoaXMucGF5UGFsQnV0dG9uQ29udGFpbmVySWQpIHtcclxuICAgICAgICAgICAgLy8gY29udGFpbmVyIGlzIHJlYWR5LCBzZXR1cCBzY3JpcHQgcmlnaHQgYXdheVxyXG4gICAgICAgICAgICB0aGlzLnNldHVwU2NyaXB0KCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gY29udGFpbmVyIGlzIG5vdCByZWFkeSwgZGVsYXkgcmVnaXN0ZXJpbmcgdW50aWwgaXQgaXNcclxuICAgICAgICAgICAgdGhpcy5yZWdpc3RlclBheVBhbFNjcmlwdFdoZW5Db250YWluZXJJc1JlYWR5ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXR1cFNjcmlwdCgpOiB2b2lkIHtcclxuICAgICAgICAvLyBmaXJzdCBjbGVhciBjb250YWluZXJcclxuICAgICAgICBpZiAoIXRoaXMuX3BheVBhbEJ1dHRvbkNvbnRhaW5lckVsZW0pIHtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYENhbm5vdCBzZXR1cCBzY3JpcHQgYmVjYXVzZSBwYXlwYWwgYnV0dG9uIGNvbnRhaW5lciB3aXRoIGlkICcke3RoaXMucGF5UGFsQnV0dG9uQ29udGFpbmVySWR9JyBpcyBub3QgeWV0IHJlYWR5YCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9wYXlQYWxCdXR0b25Db250YWluZXJFbGVtLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gICAgICAgIGlmICghd2luZG93W3RoaXMucGF5cGFsV2luZG93TmFtZV0pIHtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1BheVBhbCBzY3JpcHQgaXMgbm90IGF2YWlsYWJsZScpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gcmVuZGVyIFBheVBhbCBidXR0b24gYXMgcGVyIHRoZWlyIGRvY3MgYXRcclxuICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5wYXlwYWwuY29tL2RvY3MvaW50ZWdyYXRpb24vZGlyZWN0L2V4cHJlc3MtY2hlY2tvdXQvaW50ZWdyYXRpb24tanN2NC9hZGQtcGF5cGFsLWJ1dHRvbi9cclxuICAgICAgICB3aW5kb3dbdGhpcy5wYXlwYWxXaW5kb3dOYW1lXS5CdXR0b24ucmVuZGVyKHtcclxuICAgICAgICAgICAgLy8gc2V0IGVudmlyb25tZW50XHJcbiAgICAgICAgICAgIGVudjogdGhpcy5jb25maWcuZW52aXJvbm1lbnQudG9TdHJpbmcoKSxcclxuXHJcbiAgICAgICAgICAgIC8vIFNob3cgdGhlIGJ1eWVyIGEgJ1BheSBOb3cnIGJ1dHRvbiBpbiB0aGUgY2hlY2tvdXQgZmxvd1xyXG4gICAgICAgICAgICBjb21taXQ6IHRoaXMuY29uZmlnLmNvbW1pdCxcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY2xpZW50IGZvciBjbGllbnQgc2lkZSBpbnRlZ3JhdGlvblxyXG4gICAgICAgICAgICBjbGllbnQ6IHRoaXMuZ2V0Q2xpZW50KCksXHJcblxyXG4gICAgICAgICAgICAvLyBzZXQgYnV0dG9uIGNvbmZpZyBpZiBhdmFpbGFibGVcclxuICAgICAgICAgICAgc3R5bGU6IHRoaXMuY29uZmlnLmJ1dHRvbixcclxuXHJcbiAgICAgICAgICAgIC8vIHNldCBmdW5kaW5nIGlmIGF2YWlsYWJsZVxyXG4gICAgICAgICAgICBmdW5kaW5nOiB0aGlzLmdldEZ1bmRpbmcoKSxcclxuXHJcbiAgICAgICAgICAgIC8vIHBheW1lbnQoKSBpcyBjYWxsZWQgd2hlbiB0aGUgYnV0dG9uIGlzIGNsaWNrZWRcclxuICAgICAgICAgICAgcGF5bWVudDogKGRhdGEsIGFjdGlvbnMpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5pbnRlZ3JhdGlvblR5cGUgPT09IFBheVBhbEludGVncmF0aW9uVHlwZS5TZXJ2ZXJTaWRlUkVTVCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNsaWVudCBuZWVkcyB0byBjcmVhdGUgcGF5bWVudCBvbiBzZXJ2ZXIgc2lkZVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb25maWcucGF5bWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgWW91IG5lZWQgc2V0IHVwIGEgY3JlYXRlIHBheW1lbnQgbWV0aG9kIGFuZCByZXR1cm5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBheVBhbCdzIHBheW1lbnQgaWQgd2hlbiB1c2luZyBzZXJ2ZXIgc2lkZSBpbnRlZ3JhdGlvbmApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUGF5cGFsIGV4cGVjdHMgcHJvbWlzZSB3aXRoIHBheW1lbnQgaWQgKHN0cmluZykgdG8gYmUgcmV0dXJuZWRcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25maWcucGF5bWVudCgpLnRvUHJvbWlzZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHBheW1lbnRJZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGF5bWVudElkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWcuaW50ZWdyYXRpb25UeXBlID09PSBQYXlQYWxJbnRlZ3JhdGlvblR5cGUuQ2xpZW50U2lkZVJFU1QpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY29uZmlnLnRyYW5zYWN0aW9ucyB8fCAhQXJyYXkuaXNBcnJheSh0aGlzLmNvbmZpZy50cmFuc2FjdGlvbnMpIHx8IHRoaXMuY29uZmlnLnRyYW5zYWN0aW9ucy5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgWW91IG5lZWQgdG8gcHJvdmlkZSBhdCBsZWFzdCAxIHRyYW5zYWN0aW9uIGZvciBjbGllbnQgc2lkZSBpbnRlZ3JhdGlvbmApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwZXJpZW5jZUNvbmZpZyA9IHRoaXMuY29uZmlnLmV4cGVyaWVuY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnMucGF5bWVudC5jcmVhdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbnM6IHRoaXMuY29uZmlnLnRyYW5zYWN0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBlcmllbmNlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dF9maWVsZHM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub19zaGlwcGluZzogKGV4cGVyaWVuY2VDb25maWcgJiYgZXhwZXJpZW5jZUNvbmZpZy5ub1NoaXBwaW5nKSA/IDEgOiAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlc2VudGF0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJhbmRfbmFtZTogKGV4cGVyaWVuY2VDb25maWcgJiYgZXhwZXJpZW5jZUNvbmZpZy5icmFuZE5hbWUpID8gZXhwZXJpZW5jZUNvbmZpZy5icmFuZE5hbWUgOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ29faW1hZ2U6IChleHBlcmllbmNlQ29uZmlnICYmIGV4cGVyaWVuY2VDb25maWcubG9nb0ltYWdlKSA/IGV4cGVyaWVuY2VDb25maWcubG9nb0ltYWdlIDogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbGVfY29kZTogKGV4cGVyaWVuY2VDb25maWcgJiYgZXhwZXJpZW5jZUNvbmZpZy5sb2NhbGVDb2RlKSA/IGV4cGVyaWVuY2VDb25maWcubG9jYWxlQ29kZSA6IG51bGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgLy8gb25BdXRob3JpemUoKSBpcyBjYWxsZWQgd2hlbiB0aGUgYnV5ZXIgYXBwcm92ZXMgdGhlIHBheW1lbnRcclxuICAgICAgICAgICAgb25BdXRob3JpemU6IChkYXRhOiBJUGF5UGFsUGF5bWVudENvbXBsZXRlRGF0YSwgYWN0aW9uczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWcuaW50ZWdyYXRpb25UeXBlID09PSBQYXlQYWxJbnRlZ3JhdGlvblR5cGUuU2VydmVyU2lkZVJFU1QpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjbGllbnQgbmVlZHMgdG8gc2VydmVyIHRvIGV4ZWN1dGUgdGhlIHBheW1lbnRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY29uZmlnLm9uQXV0aG9yaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKGBZb3UgbmVlZCBzZXQgdXAgYW4gZXhlY3V0ZSBtZXRob2Qgd2hlbiB1c2luZyBzZXJ2ZXIgc2lkZSBpbnRlZ3JhdGlvbmApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUGF5cGFsIGV4cGVjdHMgcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5vbkF1dGhvcml6ZShkYXRhLCBhY3Rpb25zKS50b1Byb21pc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWcuaW50ZWdyYXRpb25UeXBlID09PSBQYXlQYWxJbnRlZ3JhdGlvblR5cGUuQ2xpZW50U2lkZVJFU1QpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIGEgY2FsbCB0byB0aGUgUkVTVCBhcGkgdG8gZXhlY3V0ZSB0aGUgcGF5bWVudFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25zLnBheW1lbnQuZXhlY3V0ZSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY29uZmlnLm9uUGF5bWVudENvbXBsZXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgWW91IHNob3VsZCBwcm92aWRlIHNvbWUgY2FsbGJhY2sgd2hlbiBwYXltZW50IGlzIGZpbmlzaGVkIHdoZW4gdXNpbmcgY2xpZW50IHNpZGUgaW50ZWdyYXRpb25gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5vblBheW1lbnRDb21wbGV0ZShkYXRhLCBhY3Rpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIG9uRXJyb3I6IChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5vbkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcub25FcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgb25DYW5jZWw6IChkYXRhLCBhY3Rpb25zKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWcub25DYW5jZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5vbkNhbmNlbChkYXRhLCBhY3Rpb25zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25DbGljazogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnLm9uQ2xpY2spIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5vbkNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHZhbGlkYXRlOiAoYWN0aW9ucykgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnLnZhbGlkYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcudmFsaWRhdGUoYWN0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBgIyR7dGhpcy5wYXlQYWxCdXR0b25Db250YWluZXJJZH1gKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENsaWVudCgpOiBJUGF5cGFsQ2xpZW50IHwgdW5kZWZpbmVkIHtcclxuICAgICAgICBpZiAodGhpcy5jb25maWcuaW50ZWdyYXRpb25UeXBlID09PSBQYXlQYWxJbnRlZ3JhdGlvblR5cGUuQ2xpZW50U2lkZVJFU1QpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5jbGllbnQpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKGBZb3UgbmVlZCB0byBzZXR1cCBjbGllbnQgaW5mb3JtYXRpb24gd2hlbiB1c2luZyBjbGllbnQgc2lkZSBpbnRlZ3JhdGlvbmApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgcHJvZHVjdGlvbjogdGhpcy5jb25maWcuY2xpZW50LnByb2R1Y3Rpb24sXHJcbiAgICAgICAgICAgICAgICBzYW5kYm94OiB0aGlzLmNvbmZpZy5jbGllbnQuc2FuZGJveFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEZ1bmRpbmcoKToge1xyXG4gICAgICAgIGFsbG93ZWQ6IGFueVtdLFxyXG4gICAgICAgIGRpc2FsbG93ZWQ6IGFueVtdXHJcbiAgICB9IHwgdW5kZWZpbmVkIHtcclxuICAgICAgICAvLyByZXNvbHZlIGZ1bmRpbmcgdG8gdXNlIHBheXBhbCdzIHByb3BlcnRpZXNcclxuICAgICAgICBpZiAoIXRoaXMuY29uZmlnLmZ1bmRpbmcpIHtcclxuICAgICAgICAgICAgLy8gbm8gZnVuZGluZyBwcm92aWRlZFxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYWxsb3dlZDogYW55W10gPSBbXTtcclxuICAgICAgICBjb25zdCBkaXNhbGxvd2VkOiBhbnlbXSA9IFtdO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jb25maWcuZnVuZGluZy5hbGxvd2VkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmZ1bmRpbmcuYWxsb3dlZC5mb3JFYWNoKHR5cGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgYWxsb3dlZC5wdXNoKHRoaXMubWFwRnVuZGluZ1R5cGUodHlwZSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5mdW5kaW5nLmRpc2FsbG93ZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25maWcuZnVuZGluZy5kaXNhbGxvd2VkLmZvckVhY2godHlwZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBkaXNhbGxvd2VkLnB1c2godGhpcy5tYXBGdW5kaW5nVHlwZSh0eXBlKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgYWxsb3dlZDogYWxsb3dlZCxcclxuICAgICAgICAgICAgZGlzYWxsb3dlZDogZGlzYWxsb3dlZFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtYXBGdW5kaW5nVHlwZSh0eXBlOiBQYXlQYWxGdW5kaW5nKTogYW55IHtcclxuICAgICAgICBpZiAodHlwZSA9PT0gUGF5UGFsRnVuZGluZy5DYXJkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXlwYWwuRlVORElORy5DQVJEO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZSA9PT0gUGF5UGFsRnVuZGluZy5DcmVkaXQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBheXBhbC5GVU5ESU5HLkNSRURJVDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGUgPT09IFBheVBhbEZ1bmRpbmcuRWx2KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXlwYWwuRlVORElORy5FTFY7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IEVycm9yKGBVbnN1cHBvcnRlZCBmdW5kaW5nIHR5cGUgJyR7dHlwZX0nYCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbiIsImltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBOZ3hQYXlwYWxDb21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudHMvcGF5cGFsLWNvbXBvbmVudCc7XHJcblxyXG5ATmdNb2R1bGUoe1xyXG4gIGltcG9ydHM6IFtcclxuICBdLFxyXG4gIGRlY2xhcmF0aW9uczogW1xyXG4gICAgTmd4UGF5cGFsQ29tcG9uZW50LFxyXG4gIF0sXHJcbiAgZXhwb3J0czogW1xyXG4gICAgTmd4UGF5cGFsQ29tcG9uZW50LFxyXG4gIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIE5neFBheVBhbE1vZHVsZSB7XHJcbn1cclxuXHJcblxyXG4iLCJleHBvcnQgZW51bSBQYXlQYWxFbnZpcm9ubWVudCB7XHJcbiAgICBTYW5kYm94ID0gJ3NhbmRib3gnLFxyXG4gICAgUHJvZHVjdGlvbiA9ICdwcm9kdWN0aW9uJ1xyXG59XHJcbiJdfQ==